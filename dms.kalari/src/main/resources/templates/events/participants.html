<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Competition Participation</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<style>
/* ================= Screen styles ================= */
.item-heading {
    font-weight: bold;
    font-size: 16pt;
    margin-top: 20px;
}

.gender-heading {
    font-weight: bold;
    font-size: 14pt;
    margin-top: 10px;
}

.category-heading {
    font-weight: bold;
    font-size: 12pt;
    margin-top: 5px;
}

@media screen {
    .print-only {
        display: none;
    }

    .container {
        padding: 20px;
    }
}

/* ================= Print-friendly styles ================= */
@media print {
    @page {
        margin: 0.5in;
        size: letter;
        @bottom-center {
            content: "Page " counter(page);
            font-size: 10pt;
            color: #555;
        }
    }

    body {
        font-family: Arial, sans-serif;
        font-size: 11pt;
        line-height: 1.4;
        margin: 0;
        padding: 0;
        color: #000;
    }

    .container {
        width: 100%;
        max-width: 100%;
        padding: 0;
        margin: 0;
    }

    h2 {
        font-size: 20pt;
        margin-bottom: 15px;
        text-align: center;
    }

    /* Hide screen-only elements */
    .no-print {
        display: none !important;
    }

    /* Item containers */
    .item-container {
        page-break-inside: avoid;
        page-break-before: auto;   /* avoids blank first page */
        page-break-after: always;  /* break after each item */
        margin-top: 0;
    }

    .item-container:last-child {
        page-break-after: auto;
    }

    .item-heading {
        font-weight: bold;
        font-size: 18pt;
        margin-top: 0;
        padding-bottom: 8px;
        border-bottom: 2px solid #444;
        color: #222;
    }

    .gender-heading {
        font-weight: bold;
        font-size: 14.5pt;
        margin-top: 12px;
        color: #333;
    }

    .category-heading {
        font-weight: bold;
        font-size: 12.5pt;
        margin-top: 10px;
        margin-bottom: 5px;
        color: #444;
    }

    /* Tables */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
        font-size: 10.5pt;
    }

    th, td {
        border: 1px solid #444;
        padding: 8px 12px;
        text-align: left;
    }

    th {
        background-color: #eaeaea;
        font-weight: bold;
        color: #222;
    }

    thead { display: table-header-group; }
    tbody { page-break-inside: avoid; }
    tr { page-break-inside: avoid; page-break-after: auto; }
    
    
    td, th {
    border-left: 1px solid #444;
    border-right: 1px solid #444;
}

tr td {
    border-top: 1px solid #444;
}

tr:last-child td {
    border-bottom: 1px solid #444;
}
    

    .category-section { page-break-inside: avoid; }
}
</style>


</head>
<body>
	<div class="container mt-4">
		<h2 class="mb-4">Competition Participation</h2>
        
        <!-- Print button for screen view -->
        <div class="no-print mb-3">
            <button class="btn btn-primary" onclick="window.print()">Print Report</button>
        </div>

		<div th:each="itemEntry, itemStat : ${matrix}" class="item-container">
			<div class="item-heading">
				Item: <span th:text="${itemEntry.key}"></span>
			</div>

			<div th:each="genderEntry : ${itemEntry.value}">
				<div class="gender-heading" th:text="${genderEntry.key}"></div>

				<div th:each="catEntry : ${genderEntry.value}" class="category-section">
					<div class="category-heading">
						Category: <span th:text="${catEntry.key}"></span>
					</div>

					<table class="table table-bordered">
						<thead class="table-light">
							<tr>
								<th>Participant</th>
								<th>Kalari</th>
								<th>Score</th>
								<th>Grade</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="mei : ${catEntry.value}">
								<td th:text="${mei.memberEventMember.userFname}"></td>
								<td th:text="${mei.memberEventNode.nodeName}"></td>
							    <td th:text="${mei.memberEventScore != 0 ? mei.memberEventScore : ''}">0</td>
							    <td th:text="${mei.memberEventGrade} ?: ''"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
        
        <!-- Print footer -->
        <div class="print-only" style="margin-top: 20px; text-align: center; font-size: 10pt;">
            Report generated on <span th:text="${#dates.format(#dates.createNow(), 'dd MMMM yyyy')}"></span>
        </div>
	</div>

    <script>
    // Add page break handling for better print experience
    document.addEventListener('DOMContentLoaded', function() {
        // Add a class to the first item container to prevent page break
        const firstItem = document.querySelector('.item-container');
        if (firstItem) {
            firstItem.classList.add('first-item');
        }
    });
    </script>
</body>
</html>