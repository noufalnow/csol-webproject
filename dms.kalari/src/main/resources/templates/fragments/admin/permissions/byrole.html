<!-- Hidden fields -->
<div class="inner-wrapper w-100 h-100 bg-light rounded mb-3 p-4 d-flex flex-column gap-3">
    <div class="row">
        <div class="col-12 col-md-12">
            <!-- Grand All Permission -->
<form name="permissions_form" id="permissions_form" th:action="@{/permissions_update}" method="post">



<div th:if="${permissions != null and !permissions.isEmpty()}" class="row align-items-center mb-4">
    <!-- Checkbox -->
    <div class="col-12 col-md-6">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="select-all"
                   onclick="toggleAllPermissions(this)">
            <label class="form-check-label ps-2 fs-6 fw-semibold" for="select-all">
                Grant All Permissions
            </label>
        </div>
    </div>

    <!-- Buttons -->
    <div class="col-12 col-md-6">
        <div class="row justify-content-end g-3 g-md-0">
            <div class="col-6 col-md-4">
                <button type="button" onclick="show_widget('permissions')"
                        class="btn btn-light w-100" title="Back">Back</button>
            </div>
            <div class="col-6 col-md-4">
                <button type="button" class="btn btn-primary w-100"
                        onclick="submitHtmlForm('permissions_form')" title="Save">Save</button>
            </div>
        </div>
    </div>
</div>


            <!-- Permission Tree -->

    <input type="hidden" name="moduleId" th:value="${moduleId}" />
    <input type="hidden" name="roleId" th:value="${roleId}" />
    <input type="hidden" name="level" th:value="${level}" />
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    
    
    
<th:block th:if="${permissions != null and !permissions.isEmpty()}">



    <div th:each="page : ${permissions}" class="permission-page">
        <!-- Page checkbox -->
        <div class="form-check mb-2">
            <input type="checkbox" 
                   class="form-check-input page-checkbox"
                   th:id="'page-' + ${page.pageId}"
                   th:data-page-id="${page.pageId}"
                   th:checked="${page.hasAllPermissions}"
                   th:disabled="${page.operations == null or page.operations.isEmpty()}"
                   onchange="togglePagePermissions(this)" />
		            <label th:for="'page-' + ${page.pageId}" 
		                   class="form-check-label fw-semibold">
		                <span th:text="${page.pageName}"></span>
		                <small class="text-muted" 
		                       th:text="'(' + ${#lists.size(page.operations)} + ' operations)'"></small>
		            </label>
        </div>
        
        <!-- Operations -->
        <div class="ms-4 operations-container" th:if="${page.operations != null and !page.operations.isEmpty()}">
            <div th:each="operation : ${page.operations}" class="form-check mb-2">
                <input type="checkbox" 
                       class="form-check-input operation-checkbox"
                       name="permissions"
                       th:id="'op-' + ${page.pageId} + '-' + ${operation.operationId}"
                       th:data-page-id="${page.pageId}"
                       th:value="|${page.pageId}_${operation.operationId}|"
                       th:checked="${operation.hasPermission}" />
		                <label th:for="'op-' + ${page.pageId} + '-' + ${operation.operationId}"
		                       class="form-check-label">
		                    <span th:text="${operation.operationName}"></span>
		                    <small style="display:none;" class="text-muted" th:text="|(${operation.alias})|"></small>
		                </label>
            </div>
        </div>
    </div>

</th:block>
<div id="error-messages" class="text-danger mt-2"></div>
</form>

<!-- Show message if no permissions found -->
<div th:if="${permissions == null or permissions.isEmpty()}">
    <li class="collection-item">
        <div class="alert alert-info">
            No permissions found for this module.
        </div>
    </li>
</div>

    

        </div>

        <!-- Buttons -->

    </div>
</div>

<style>
form {
  max-width: 100%;
  margin: 0 auto;
  }
</style>

