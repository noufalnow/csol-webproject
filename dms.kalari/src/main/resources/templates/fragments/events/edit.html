<div class="container-fluid">
  <!-- Modal Header -->
  <div class="modal-header">
    <h5 class="modal-title" id="editEventModalLabel" th:text="${pageTitle}">Edit Event</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>

  <!-- Modal Body -->
  <div class="modal-body">
    <form id="editEventForm" 
          th:action="@{'/champ_eventedit/' + ${eventId}}"
          method="post" 
          th:object="${event}">

      <div class="row g-3 mb-2">
        <!-- Event Name -->
        <div class="col-12 col-md-6">
          <label for="event_name" class="form-label required-field">Event Name</label>
          <input type="text" id="event_name" th:field="*{eventName}" class="form-control" required>
        </div>

<div class="col-12 col-md-3">
  <label for="event_start" class="form-label required-field">Start Date</label>
  <input type="date" id="event_start"
         th:field="*{eventPeriodStart}"
         th:value="${#temporals.format(event.eventPeriodStart, 'yyyy-MM-dd')}"
         class="form-control" required>
</div>

<div class="col-12 col-md-3">
  <label for="event_end" class="form-label required-field">End Date</label>
  <input type="date" id="event_end"
         th:field="*{eventPeriodEnd}"
         th:value="${#temporals.format(event.eventPeriodEnd, 'yyyy-MM-dd')}"
         class="form-control" required>
</div>

      </div>

      <div class="row g-3 mb-2">
        <div class="col-12 col-md-4">
          <label for="event_venue" class="form-label required-field">Venue</label>
          <input type="text" id="event_venue" th:field="*{eventVenue}" class="form-control" required>
        </div>
        <div class="col-12 col-md-4">
          <label for="event_phone" class="form-label required-field">Official Phone</label>
          <input type="tel" id="event_phone" th:field="*{eventOfficialPhone}" class="form-control" required>
        </div>
        <div class="col-12 col-md-4">
          <label for="event_year" class="form-label required-field">Year</label>
          <input type="number" id="event_year" th:field="*{eventYear}" min="2000" max="2100" class="form-control" required>
        </div>
      </div>

      <!-- Event Items Tabs -->
      <div class="row mb-3">
        <div class="col-12">
          <label class="form-label fw-bold">Select Event Items</label>
          <ul class="nav nav-tabs" id="itemTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="senior-tab" data-bs-toggle="tab" data-bs-target="#senior"
                      type="button" role="tab" aria-controls="senior" aria-selected="true">Senior</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="junior-tab" data-bs-toggle="tab" data-bs-target="#junior"
                      type="button" role="tab" aria-controls="junior" aria-selected="false">Junior</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="subjunior-tab" data-bs-toggle="tab" data-bs-target="#subjunior"
                      type="button" role="tab" aria-controls="subjunior" aria-selected="false">Sub-Junior</button>
            </li>
          </ul>

          <div class="tab-content border border-top-0 p-3 bg-light rounded-bottom">
            <!-- Senior Tab -->
            <div class="tab-pane fade show active" id="senior" role="tabpanel" aria-labelledby="senior-tab">
              <div class="row row-cols-1 row-cols-md-2 g-2" style="max-height: 300px; overflow-y: auto;">
                <div class="col" th:each="item : ${eventItems}">
                  <div class="form-check">
                    <input class="form-check-input senior-item" type="checkbox"
                           th:id="'senior_' + ${item.evitemId}" th:name="seniorItemIds"
                           th:value="${item.evitemId}" th:checked="${#lists.contains(seniorItemIds, item.evitemId)}">
                    <label class="form-check-label" th:for="'senior_' + ${item.evitemId}" th:text="${item.evitemName}"></label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Junior Tab -->
            <div class="tab-pane fade" id="junior" role="tabpanel" aria-labelledby="junior-tab">
              <div class="row row-cols-1 row-cols-md-2 g-2" style="max-height: 300px; overflow-y: auto;">
                <div class="col" th:each="item : ${eventItems}">
                  <div class="form-check">
                    <input class="form-check-input junior-item" type="checkbox"
                           th:id="'junior_' + ${item.evitemId}" th:name="juniorItemIds"
                           th:value="${item.evitemId}" th:checked="${#lists.contains(juniorItemIds, item.evitemId)}">
                    <label class="form-check-label" th:for="'junior_' + ${item.evitemId}" th:text="${item.evitemName}"></label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sub-Junior Tab -->
            <div class="tab-pane fade" id="subjunior" role="tabpanel" aria-labelledby="subjunior-tab">
              <div class="row row-cols-1 row-cols-md-2 g-2" style="max-height: 300px; overflow-y: auto;">
                <div class="col" th:each="item : ${eventItems}">
                  <div class="form-check">
                    <input class="form-check-input subjunior-item" type="checkbox"
                           th:id="'subjunior_' + ${item.evitemId}" th:name="subjuniorItemIds"
                           th:value="${item.evitemId}" th:checked="${#lists.contains(subjuniorItemIds, item.evitemId)}">
                    <label class="form-check-label" th:for="'subjunior_' + ${item.evitemId}" th:text="${item.evitemName}"></label>
                  </div>
                </div>
              </div>
            </div>

          </div>
          <div id="itemsError" class="text-danger mt-2"></div>
        </div>
      </div>

      <div id="error-messages" class="text-danger"></div>
    </form>
  </div>

  <!-- Modal Footer -->
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <button type="button" class="btn btn-primary" onclick="validateAndSubmit()">Update Event</button>
  </div>
</div>

<style>
form {
  max-width: 100%;
}

.modal-dialog {
  max-width: 80% !important;
}

@media (max-width: 768px) {
  .modal-dialog {
    max-width: 100% !important;
    margin: 10px;
  }
}

.modal-body {
  max-height: 70vh;
  overflow-y: auto;
}
</style>


<script>
document.getElementById('event_start').addEventListener('change', function() {
    const endDate = document.getElementById('event_end');
    if (this.value && endDate.value && endDate.value < this.value) endDate.value = this.value;
    endDate.min = this.value;
});

function validateEventItems() {
    const seniorChecked = document.querySelectorAll('.senior-item:checked').length > 0;
    const juniorChecked = document.querySelectorAll('.junior-item:checked').length > 0;
    const subjuniorChecked = document.querySelectorAll('.subjunior-item:checked').length > 0;
    const errorElement = document.getElementById('itemsError');

    if (!seniorChecked && !juniorChecked && !subjuniorChecked) {
        errorElement.textContent = "Please select at least one item from Senior, Junior, or Sub-Junior tabs";
        errorElement.style.display = 'block';
        return false;
    }
    errorElement.style.display = 'none';
    return true;
}


function validateAndSubmit() {
    if (validateEventItems()) {
        submitHtmlForm('editEventForm', '#events_target');
    }
}

</script>
