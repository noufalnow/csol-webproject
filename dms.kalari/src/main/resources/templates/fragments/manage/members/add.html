<div class="container-fluid">
  <!-- Modal Header -->
  <div class="modal-header">
    <h5 class="modal-title" id="addUserModalLabel" th:text="${pageTitle}">Add New Member</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>
  
  <!-- Modal Body -->
  <div class="modal-body">
   <form id="addUserForm"
      th:action="@{/members_add/{id}(id=${nodeId})}"
      method="post"
      th:object="${user}"
      enctype="multipart/form-data">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      
      <!-- Personal Information -->
      <div class="row mb-3">
        <div class="col-12">
          <h6 class="border-bottom pb-2">Personal Information</h6>
        </div>
      </div>
      
      <div class="row g-3 mb-2">
        <div class="col-12 col-lg-3">
          <label for="user_fname" class="form-label">First Name</label>
          <input type="text" id="user_fname" th:field="*{userFname}" class="form-control" required>
        </div>
        <div class="col-12 col-lg-3">
          <label for="user_lname" class="form-label">Last Name</label>
          <input type="text" id="user_lname" th:field="*{userLname}" class="form-control" required>
        </div>
        <div class="col-12 col-lg-3">
          <label for="user_dob" class="form-label">Date of Birth</label>
          <input type="date" id="user_dob" th:field="*{userDob}" class="form-control">
        </div>
        <div class="col-12 col-lg-3">
          <label for="gender" class="form-label">Gender</label>
          <select id="gender" th:field="*{gender}" class="form-select">
            <option value="">Select Gender</option>
            <option th:each="gender : ${T(com.dms.kalari.admin.entity.CoreUser.Gender).values()}" 
                    th:value="${gender}" th:text="${gender.name()}"></option>
          </select>
        </div>
      </div>
      
      <div class="row g-3 mb-2">
        <div class="col-12 col-lg-3">
          <label for="aadhaarNumber" class="form-label">Aadhaar Number</label>
          <input type="text" id="aadhaarNumber" th:field="*{aadhaarNumber}" class="form-control" maxlength="12" placeholder="12-digit Aadhaar">
        </div>
        <div class="col-12 col-lg-3">
          <label for="bloodGroup" class="form-label">Blood Group</label>
          <select id="bloodGroup" th:field="*{bloodGroup}" class="form-select">
            <option value="" selected>Select Blood Group</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
          </select>
        </div>
        <div class="col-12 col-lg-3">
          <label for="mobileNumber" class="form-label">Mobile Number</label>
          <input type="tel" id="mobileNumber" th:field="*{mobileNumber}" class="form-control" maxlength="10" placeholder="10-digit mobile number">
        </div>
        <div class="col-12 col-lg-3">
          <label for="emergencyContact" class="form-label">Emergency Contact</label>
          <input type="tel" id="emergencyContact" th:field="*{emergencyContact}" class="form-control" maxlength="15" placeholder="Emergency contact number">
        </div>
      </div>
      
      <!-- Account Information -->
      <div class="row mb-3 mt-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">Account Information</h6>
        </div>
      </div>
      
      <div class="row g-3 mb-2">
        <div class="col-12 col-lg-3">
          <label for="user_email" class="form-label">Email</label>
          <input type="email" id="user_email" th:field="*{userEmail}" class="form-control" required>
        </div>
        <div class="col-12 col-lg-3">
          <label for="user_desig" class="form-label">Role</label>
          <select id="user_desig" th:field="*{userDesig}" class="form-select">
            <option value="">Select Role</option>
            <option th:each="designation : ${designations}" th:value="${designation.desigId}" th:text="${designation.desigName}"></option>
          </select>
        </div>
        <div class="col-12 col-lg-3">
          <label class="form-label d-block">Status</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="active" name="userStatus" value="1" th:checked="*{userStatus == 1}">
            <label class="form-check-label" for="active">Active</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" id="inactive" name="userStatus" value="2" th:checked="*{userStatus == 2}">
            <label class="form-check-label" for="inactive">Inactive</label>
          </div>
        </div>
      </div>
      
      <!-- Address Information -->
      <div class="row mb-3 mt-4">
        <div class="col-12">
          <h6 class="border-bottom pb-2">Guardian/ Address Information</h6>
        </div>
      </div>

<div class="row mb-3">
  <!-- Address & Parents Information -->
  <div class="col-12">
    <div class="row g-3 mb-2">
      <div class="col-12 col-lg-6">
        <label for="fatherName" class="form-label">Father's Name</label>
        <input type="text" id="fatherName" th:field="*{fatherName}" class="form-control">
      </div>
      <div class="col-12 col-lg-6">
        <label for="motherName" class="form-label">Mother's Name</label>
        <input type="text" id="motherName" th:field="*{motherName}" class="form-control">
      </div>

      <div class="col-12 col-lg-6">
        <label for="addressLine1" class="form-label">House No./ House Name</label>
        <input type="text" id="addressLine1" th:field="*{addressLine1}" class="form-control">
      </div>
      <div class="col-12 col-lg-6">
        <label for="addressLine2" class="form-label">Street / Lane / Road</label>
        <input type="text" id="addressLine2" th:field="*{addressLine2}" class="form-control">
      </div>

      <div class="col-12 col-lg-4">
        <label for="addressLine3" class="form-label">Village / Taluk / District</label>
        <input type="text" id="addressLine3" th:field="*{addressLine3}" class="form-control">
      </div>
	  <div class="col-12 col-lg-4"><div th:replace="fragments/common/states :: stateSelect('addressState', 'State')"></div></div>
      <div class="col-12 col-lg-4">
        <label for="addressPin" class="form-label">PIN Code</label>
        <input type="text" id="addressPin" th:field="*{addressPin}" class="form-control" maxlength="6" placeholder="6-digit PIN">
      </div>
    </div>
  </div>
</div>

<!-- Address Information -->
<div class="row mb-3 mt-4">
  <div class="col-12">
    <h6 class="border-bottom pb-2">Documents</h6>
  </div>
</div>

<!-- File Uploads in one row -->
<div class="row g-3 mb-3">
  <div class="col-12 col-lg-4 text-center">
    <label class="form-label d-block">Profile Photo</label>
    <input type="file" id="photoFileId" name="photoFileId"
           th:field="*{photoFileId}" class="d-none" accept="image/*">
    <div id="photoFilePreview" class="preview-box">Click to upload</div>
    <small class="text-muted">Max 512KB (JPG, PNG, JPEG)</small>
    <div id="photoFileError" class="text-danger small mt-1"></div>
  </div>

  <div class="col-12 col-lg-4 text-center">
    <label class="form-label d-block">ID Proof</label>
    <input type="file" id="idFileId" name="idFileId"
           th:field="*{idFileId}" class="d-none" accept="image/*">
    <div id="idFilePreview" class="preview-box">Click to upload</div>
    <small class="text-muted">Max 512KB (JPG, PNG, JPEG)</small>
    <div id="idFileError" class="text-danger small mt-1"></div>
  </div>

  <div class="col-12 col-lg-4 text-center">
    <label class="form-label d-block">Age Proof</label>
    <input type="file" id="ageproofFileId" name="ageproofFileId"
           th:field="*{ageproofFileId}" class="d-none" accept="image/*">
    <div id="ageproofFilePreview" class="preview-box">Click to upload</div>
    <small class="text-muted">Max 512KB (JPG, PNG, JPEG)</small>
    <div id="ageproofFileError" class="text-danger small mt-1"></div>
  </div>
</div>

    </form>
  </div>
  
  <!-- Modal Footer -->
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <button type="button" class="btn btn-primary" onclick="submitHtmlForm('addUserForm')">Add Participants</button>
  </div>
</div>

<style>
.preview-box {
  width:150px;
  height:150px;
  background:#f0f0f0;
  border:1px solid #ddd;
  border-radius:8px;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  cursor: pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#aaa;
  margin:auto;
  overflow:hidden;
}

form { max-width: 100%;
  background-color: #ffd3f44f;
}

.modal-dialog { max-width: 90% !important; }
@media (max-width: 768px) {
  .modal-dialog { max-width: 100% !important; margin: 10px; }
  .preview-box { width: 120px; height: 120px; }
}
.modal-body { max-height: 70vh; overflow-y: auto; }
</style>



<script>
(function () {
	  const allowedExtensions = ["jpg", "jpeg", "png"];
	  const maxSize = 512 * 1024;

	  function initFileUpload(inputId, previewId, errorId) {
	    const fileInput = document.getElementById(inputId);
	    const previewBox = document.getElementById(previewId);
	    const errorBox = document.getElementById(errorId);

	    if (!fileInput || !previewBox || !errorBox) return;

	    previewBox.addEventListener("click", () => fileInput.click());

	    fileInput.addEventListener("change", function () {
	      errorBox.textContent = "";
	      const file = this.files[0];

	      if (file) {
	        const ext = file.name.split(".").pop().toLowerCase();
	        if (!allowedExtensions.includes(ext)) {
	          errorBox.textContent = "Allowed formats: JPEG, JPG, PNG";
	          fileInput.value = "";
	          return;
	        }

	        if (file.size > maxSize) {
	          errorBox.textContent = "File size must be less than 512KB.";
	          fileInput.value = "";
	          return;
	        }

	        const reader = new FileReader();
	        reader.onload = function (e) {
	          previewBox.style.backgroundImage = `url(${e.target.result})`;
	          previewBox.textContent = "";
	        };
	        reader.readAsDataURL(file);
	      }
	    });
	  }

	  // initialize all file inputs
	  initFileUpload("photoFileId", "photoFilePreview", "photoFileError");
	  initFileUpload("idFileId", "idFilePreview", "idFileError");
	  initFileUpload("ageproofFileId", "ageproofFilePreview", "ageproofFileError");

	})();

</script>
