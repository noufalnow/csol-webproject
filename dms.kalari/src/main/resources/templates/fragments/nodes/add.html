<!-- fragments/add_node.html -->
<div th:fragment="content">
	<div class="modal-header">
		<h5 class="modal-title" id="addNodeModalLabel" th:text="${pageTitle}">Add
			New Node</h5>
		<button type="button" class="btn-close" data-bs-dismiss="modal"
			aria-label="Close"></button>
	</div>
	<!-- Modal Body -->
	<div class="modal-body">
		<form id="addNodeForm"
			th:action="@{/branch_nodeadd/{id}(id=${parentId})}" method="post"
			th:object="${node}" enctype="multipart/form-data">

			<input type="hidden" th:name="${_csrf.parameterName}"
				th:value="${_csrf.token}" />

			<!-- Node Basic Info -->
			<div class="row">
				<!-- Left Column -->
				<div class="col-12 col-lg-9">
					<!-- Name Field -->
					<div class="row mb-4">
						<div class="col-12">
							<label for="nodeName" class="form-label required-field">Name</label>
							<input type="text" id="nodeName" th:field="*{nodeName}" class="form-control" required>
						</div>
					</div>

					<!-- Register Number Field -->
					<div class="row mb-4">
						<div class="col-9">
							<label for="registerNumber" class="form-label required-field">Register
								Number</label> 
								<input type="text" id="registerNumber" th:field="*{registerNumber}" class="form-control" required>
						</div>
					</div>
					
											<div class="row">
				<div class="col-12">
					<label class="form-label">Status</label>
					<div class="d-flex align-items-center gap-3">
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" id="active"
								name="nodeStatus" value="1" th:checked="*{nodeStatus == 1}">
							<label class="form-check-label" for="active">Active</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" id="inactive"
								name="nodeStatus" value="0" th:checked="*{nodeStatus == 0}">
							<label class="form-check-label" for="inactive">Inactive</label>
						</div>
					</div>
				</div>
			</div>
					
					
				</div>

				<!-- Right Column - Photo Upload -->
				<div class="col-12 col-lg-3 photo-column">
					<div class="row mb-3">
						<div class="col-12 text-center">
							<label class="form-label d-block">Logo/ Emblem</label> <input
								type="file" id="photoFileId" name="photoFileId"
								th:field="*{photoFileId}" class="d-none" accept="image/*">
							<div id="imagePreview" class="preview-box">Click to upload</div>
							<small class="text-muted">Max 512KB (JPG, PNG, BMP)</small>
							<div id="fileError" class="text-danger small mt-1"></div>
						</div>
					</div>
				</div>
			
			

			</div>
			

			<!-- Address Information -->
			<div class="row mb-3 mt-4">
				<div class="col-12">
					<h6 class="border-bottom pb-2">Address Information</h6>
				</div>
			</div>

			<div class="row g-3 mb-2">
				<div class="col-12 col-lg-6">
					<label for="addressLine1" class="form-label">Building No. /
						Building Name</label> <input type="text" id="addressLine1"
						th:field="*{addressLine1}" class="form-control" required>
				</div>
				<div class="col-12 col-lg-6">
					<label for="addressLine2" class="form-label">Street / Lane
						/ Road</label> <input type="text" id="addressLine2"
						th:field="*{addressLine2}" class="form-control" required>
				</div>
				<div class="col-12 col-lg-4">
					<label for="addressLine3" class="form-label">Village /
						Thaluk / District</label> <input type="text" id="addressLine3"
						th:field="*{addressLine3}" class="form-control" required>
				</div>
				<div class="col-12 col-lg-4">
					<label for="addressState" class="form-label">State</label> <input
						type="text" id="addressState" th:field="*{addressState}"
						class="form-control" required>
				</div>
				<div class="col-12 col-lg-4">
					<label for="addressPin" class="form-label">PIN Code</label> <input
						type="text" id="addressPin" th:field="*{addressPin}"
						class="form-control" maxlength="6" placeholder="6-digit PIN"
						required>
				</div>
			</div>

			<!-- Register Number -->





			<div id="error-messages" class="text-danger"></div>
		</form>
	</div>

	<!-- Modal Footer -->
	<div class="modal-footer">
		<button type="button" class="btn btn-secondary"
			data-bs-dismiss="modal">Cancel</button>
		<button type="button" class="btn btn-primary"
			onclick="submitHtmlForm('addNodeForm')">Add Affiliation</button>
	</div>
</div>

<style>
.preview-box {
	width: 150px;
	height: 150px;
	background: #f0f0f0;
	border: 1px solid #ddd;
	border-radius: 8px;
	background-size: contain;
	background-position: center;
	background-repeat: no-repeat;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	color: #aaa;
	margin: auto;
	overflow: hidden;
}

form {
	max-width: 100%;
}

.modal-dialog {
	max-width: 90% !important;
}

@media ( max-width : 768px) {
	.modal-dialog {
		max-width: 100% !important;
		margin: 10px;
	}
	.preview-box {
		width: 120px;
		height: 120px;
	}
}

.modal-body {
	max-height: 70vh;
	overflow-y: auto;
}
</style>
<script>
(function () {
  let fileInput = document.getElementById("photoFileId");
  let imagePreview = document.getElementById("imagePreview");
  let fileError = document.getElementById("fileError");

  if (!fileInput) return;

  const allowedExtensions = ["jpg", "jpeg", "png", "bmp"];
  const maxSize = 512 * 1024;

  imagePreview.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", function () {
    fileError.textContent = "";
    const file = this.files[0];

    if (file) {
      const ext = file.name.split(".").pop().toLowerCase();
      if (!allowedExtensions.includes(ext)) {
        fileError.textContent = "Allowed formats: JPEG, JPG, PNG, BMP.";
        fileInput.value = "";
        return;
      }

      if (file.size > maxSize) {
        fileError.textContent = "File size must be less than 512KB.";
        fileInput.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        imagePreview.style.backgroundImage = `url(${e.target.result})`;
        imagePreview.textContent = "";
      };
      reader.readAsDataURL(file);
    }
  });
})();
</script>

