<div th:fragment="content">
	<!-- Modal Header -->
	<div class="modal-header">
		<h5 class="modal-title">Association Details</h5>
		<button type="button" class="btn-close" data-bs-dismiss="modal"
			aria-label="Close"></button>
	</div>

	<!-- Modal Body -->
	<div class="modal-body">
		<div class="container-fluid">
			<!-- Main Profile Card -->
			<div class="dms-card mb-4">
				<div class="dms-card-header">
					<i class="fas fa-university me-2"></i>ASSOCIATION PROFILE
				</div>
				<div class="dms-card-body">
					<div class="row align-items-center">
						<!-- Left Column - Name & Details -->
						<div class="col-md-8">
							<h2 class="mb-2 text-start" th:text="${node.nodeName}">Association
								Name</h2>
							<h5 class="mb-2 fw-bold" th:text="${node.registerNumber}">Register
								Number</h5>

							<div class="d-flex flex-wrap gap-2 mb-4">
								<span class="badge-dms"> <i class="fas fa-hashtag me-1"></i>
									REG NO: <span th:text="${node.registerNumber}">REG-001</span>
								</span> <span th:if="${node.nodeStatus == 1}" class="badge bg-success">
									<i class="fas fa-check-circle me-1"></i> ACTIVE
								</span> <span th:if="${node.nodeStatus == 2}"
									class="badge bg-secondary"> <i
									class="fas fa-times-circle me-1"></i> INACTIVE
								</span>
							</div>

							<div class="detail-row">
								<div class="detail-label">Status:</div>
								<div class="detail-value">
									<span th:if="${node.nodeStatus == 1}" class="text-success">
										<i class="fas fa-check-circle me-1"></i> Active
									</span> <span th:if="${node.nodeStatus == 2}" class="text-secondary">
										<i class="fas fa-times-circle me-1"></i> Inactive
									</span>
								</div>
							</div>
						</div>

						<!-- Right Column - Logo -->
						<div class="col-md-4 text-center">
							<div class="profile-photo-container mx-auto mb-3">
								<img th:if="${node.photoFile != null}"
									th:src="@{/files/view/{id}(id=${node.photoFile})}"
									alt="Association Logo" class="profile-photo"> <img
									th:if="${node.photoFile == null}"
									src="/images/default-organization.png" alt="Default Logo"
									class="profile-photo" style="opacity: .1;">
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<!-- Address Information Column -->
				<div class="col-lg-6">
					<div class="dms-card">
						<div class="dms-card-header">
							<i class="fas fa-map-marker-alt me-2"></i>ADDRESS INFORMATION
						</div>
						<div class="dms-card-body">
							<div class="info-group">
								<div class="info-label">BUILDING NO. / NAME</div>
								<div class="info-value" th:text="${node.addressLine1}">
									Building information not available</div>
							</div>
							<div class="info-group">
								<div class="info-label">STREET / LANE / ROAD</div>
								<div class="info-value" th:text="${node.addressLine2}">
									Street information not available</div>
							</div>
							<div class="info-group">
								<div class="info-label">VILLAGE / THALUK / DISTRICT</div>
								<div class="info-value" th:text="${node.addressLine3}">
									Area information not available</div>
							</div>
							<div class="info-group">
								<div class="info-label">STATE & PIN CODE</div>
								<div class="info-value">
									<span th:text="${node.addressState}"></span>, <span
										th:text="${node.addressPin}"></span>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Contact & Status Column -->
				<div class="col-lg-6">
					<div class="dms-card">
						<div class="dms-card-header">
							<i class="fas fa-info-circle me-2"></i>BRANCH STATUS
						</div>
						<div class="dms-card-body">
							<div class="info-group">
								<div class="info-label">ASSOCIATION STATUS</div>
								<div class="info-value">
									<span th:if="${node.nodeStatus == 1}"
										class="status-badge status-student"> <i
										class="fas fa-check-circle me-1"></i> ACTIVE
									</span> <span th:if="${node.nodeStatus == 2}"
										class="status-badge status-inactive"> <i
										class="fas fa-times-circle me-1"></i> INACTIVE
									</span>
								</div>
							</div>
							<div class="info-group">
								<div class="info-label">REGISTER NUMBER</div>
								<div class="info-value">
									<i class="fas fa-id-card me-2"></i> <span
										th:text="${node.registerNumber}">Not specified</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Branch Information Cards -->
			<div class="row mt-4">
				<!-- History Card -->
				<div class="col-lg-4">
					<div class="dms-card ">
						<div class="dms-card-header">
							<i class="fas fa-history me-2"></i>BRANCH HISTORY
						</div>
						<div class="dms-card-body">
							<div class="info-group">
								<div class="info-value"
									th:text="${node.branchHistory ?: 'No history information available.'}">
									Branch history details not provided.</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Activities Card -->
				<div class="col-lg-4">
					<div class="dms-card ">
						<div class="dms-card-header">
							<i class="fas fa-tasks me-2"></i>ACTIVITIES
						</div>
						<div class="dms-card-body">
							<div class="info-group">
								<div class="info-value"
									th:text="${node.branchActivity ?: 'No activity information available.'}">
									Branch activities not specified.</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Vision Card -->
				<div class="col-lg-4">
					<div class="dms-card ">
						<div class="dms-card-header">
							<i class="fas fa-eye me-2"></i>VISION
						</div>
						<div class="dms-card-body">
							<div class="info-group">
								<div class="info-value"
									th:text="${node.branchVision ?: 'No vision information available.'}">
									Branch vision not defined.</div>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="row mt-4">
				<form id="documentForm"
					th:action="@{'/branch_upload/' + ${maskedNodeId}}" method="post"
					enctype="multipart/form-data">
					<div class="col-lg-12">
						<div class="dms-card">
							<div class="dms-card-header py-2">
								<i class="fas fa-file-upload me-2"></i> Documents
							</div>




							<div class="dms-card-body py-3">

								<!-- Uploaded Files Table -->
								<div class="table-responsive mb-3">
									<table class="table table-sm table-bordered align-middle mb-0">
										<thead class="table-light">
											<tr>
												<th style="width: 60%">Document Name</th>
												<th class="text-center" style="width: 25%">Date</th>
												<th style="width: 15%" class="text-center">Actions</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="doc : ${uploadedDocs}">
												<td th:text="${doc.fileActualName}">agreement.pdf</td>
												<td class="text-center"
													th:text="${#temporals.format(doc.tCreated, 'dd-MM-yyyy')}">25-10-2025</td>
												<td class="text-center">
													<div class="d-flex justify-content-center gap-1">
														<!-- Download -->
														<a th:href="@{'/files/view/' + ${doc.fileId}}"
															class="btn btn-sm btn-outline-primary btn-micro"
															target="_blank" rel="noopener noreferrer"
															title="Download"> <i class="fas fa-download"></i>
														</a>

														<!-- Delete -->
														<a href="javascript:void(0);"
															class="btn btn-sm btn-outline-danger btn-micro"
															title="Delete"
															th:onclick="|confirmDelete('${xorMaskHelper.mask(doc.fileId)}')|"
															th:if="${#authorization.expression('hasAuthority(''PRIV_branch_upload_remove'')')}">
															<i class="fas fa-trash-alt"></i>
														</a>

													</div>
												</td>

											</tr>

											<tr th:if="${#lists.isEmpty(uploadedDocs)}">
												<td colspan="3" class="text-center text-muted small">No
													documents uploaded yet</td>
											</tr>
										</tbody>

									</table>
								</div>


								<!-- Upload Section -->
								<div
									th:if="${#authorization.expression('hasAuthority(''PRIV_branch_upload'')')}">
									<div class="row align-items-center ">
										<div class="col-md-7 col-sm-12">
											<div class="input-group input-group-sm mt-3">
												<input type="file" id="pdfFileInput" name="file"
													class="d-none" accept="application/pdf">

												<button type="button" class="btn btn-outline-primary btn-sm"
													onclick="document.getElementById('pdfFileInput').click();">
													<i class="fas fa-upload me-1"></i> Select PDF
												</button>

												<span id="pdfFileLabel"
													class="form-control form-control-sm bg-light text-truncate">No
													file chosen</span>
											</div>
											<small class="text-muted d-block mt-1">Max 2 MB (PDF
												only)</small>
											<div id="pdfFileError" class="text-danger small mt-1"></div>
										</div>

										<div class="col-md-5 text-end mt-md-0">
											<button type="button" class="btn btn-success btn-sm px-3"
												id="uploadBtn"
												onclick="submitHtmlForm('documentForm', 'modal')"
												style="min-height: 35px;">
												<i class="fas fa-cloud-upload-alt me-1"></i> Upload
											</button>
										</div>
									</div>
								</div>

							</div>
							<!-- card-body -->
						</div>
					</div>
				</form>
			</div>









		</div>
	</div>

	<!-- Modal Footer -->
	<div class="modal-footer">
		<button type="button" class="btn btn-secondary"
			data-bs-dismiss="modal">Close</button>
	</div>
</div>


<script>
	(function() {
		const fileInput = document.getElementById("pdfFileInput");
		const fileError = document.getElementById("pdfFileError");
		const fileLabel = document.getElementById("pdfFileLabel");

		if (!fileInput)
			return;

		const allowedExtension = "pdf";
		const maxSize = 2 * 1024 * 1024; // 2 MB

		fileInput
				.addEventListener(
						"change",
						function() {
							fileError.textContent = "";
							const file = this.files[0];

							if (file) {
								const ext = file.name.split(".").pop()
										.toLowerCase();
								if (ext !== allowedExtension) {
									fileError.textContent = "Only PDF files are allowed.";
									fileInput.value = "";
									fileLabel.textContent = "No file chosen";
									return;
								}

								if (file.size > maxSize) {
									fileError.textContent = "File size must be less than 2 MB.";
									fileInput.value = "";
									fileLabel.textContent = "No file chosen";
									return;
								}

								fileLabel.textContent = file.name;
							} else {
								fileLabel.textContent = "No file chosen";
							}
						});
	})();
	
	
	function confirmDelete(maskedId) {
	    Swal.fire({
	        title: 'Are you sure?',
	        text: "This document will be deleted!",
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#d33',
	        cancelButtonColor: '#3085d6',
	        confirmButtonText: 'Yes, delete it!',
	        reverseButtons: true
	    }).then((result) => {
	        if (result.isConfirmed) {
	            // Call your existing function after confirmation
	            loadContent('/branch_upload_remove/' + maskedId);
	        }
	    });
	}
	
</script>