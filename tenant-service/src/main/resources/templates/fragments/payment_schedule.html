<div class="container">
    <h3>Payment Schedule</h3>
    <form id="paymentScheduleForm" method="POST" action="/propertyPayOptions/html/add">
        <input type="hidden" id="poptDocId" name="poptDocId" th:value="${refId}">
        <div id="paymentScheduleRows">
            <!-- Payment Option Row Template -->
            <div class="payment-row">
                <div class="row align-top">
                    <!-- Custom class for alignment -->
                    <div class="col">
                        <label for="popt_date">Payment Date</label>
                        <input type="date" class="form-control" name="popt_date[]" required>
                    </div>
                    <div class="col">
                        <label for="popt_amount">Amount</label>
                        <input type="number" class="form-control" name="popt_amount[]" required>
                    </div>
                    <div class="col">
                        <label for="popt_type">Payment Type</label>
                        <select class="form-control popt_type" name="popt_type[]" required onchange="toggleBankOptions(this)">
                            <option value="1">Cash</option>
                            <option value="2">Cheque</option>
                            <option value="3">Bank Transfer</option>
                        </select>
                    </div>
                    <div class="col bank-select" style="display: none;">
                        <label for="popt_bank">Bank</label>
                        <select class="form-control" name="popt_bank[]">
                            <option value="">Select Bank</option>
                            <option value="1">Bank 1</option>
                            <option value="2">Bank 2</option>
                            <option value="3">Bank 3</option>
                        </select>
                        <span class="error-message" style="color:red;"></span>
                    </div>
                    <div class="col">
                        <button type="button" class="btn btn-danger remove-row" onclick="removePaymentRow(this)">Remove</button>
                    </div>
                </div>
                <hr>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <button type="button" class="btn btn-primary" onclick="addPaymentRow()">Add More</button>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col">
                <button type="button" onclick="submitHtmlForm('paymentScheduleForm')">Submit Payment Schedule</button>
            </div>
        </div>
    </form>

    <div id="error-messages" class="error-message" style="display: none;"></div>
</div>


<script>
// Function to dynamically add new payment rows
function addPaymentRow() {
    let paymentRow = document.querySelector('.payment-row').cloneNode(true);
    let paymentRowsContainer = document.getElementById('paymentScheduleRows');

    // Reset the values of the cloned row
    paymentRow.querySelectorAll('input').forEach(input => {
        input.value = ''; // Clear input values
        input.classList.remove('has-error'); // Remove error class
        let errorMessage = input.nextElementSibling; // Assuming the error message is the next sibling
        if (errorMessage) {
            errorMessage.style.display = 'none'; // Hide error message
        }
    });

    paymentRow.querySelectorAll('select').forEach(select => {
        select.selectedIndex = 0; // Reset to default
    });

    paymentRow.querySelector('.bank-select').style.display = 'none'; // Hide bank dropdown by default

    paymentRowsContainer.appendChild(paymentRow);
}


// Function to remove a payment row
function removePaymentRow(button) {
    let paymentRowsContainer = document.getElementById('paymentScheduleRows');
    
    if (paymentRowsContainer.childElementCount > 1) {
        button.closest('.payment-row').remove();
    } else {
        alert('At least one payment row is required.');
    }
}

// Function to toggle the bank dropdown based on payment type
function toggleBankOptions(selectElement) {
    let paymentType = parseInt(selectElement.value, 10); // Convert to integer
    let bankSelect = selectElement.closest('.row').querySelector('.bank-select');

    if (paymentType === 1) { // Cash
        bankSelect.style.display = 'none'; // Hide bank dropdown
    } else {
        bankSelect.style.display = 'block'; // Show bank dropdown for other payment types
    }
}






</script>


<style>

form {
  max-width: 1000px;
  }
.container {
	max-width: 900px;
	margin: 20px auto;
}

.payment-row {
	padding: 10px 0;
}

.row {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 10px;
}

.col {
	flex: 1;
	margin-right: 10px;
}

.col:last-child {
	margin-right: 0;
}

.remove-row {
	margin-top: 30px;
}

.align-top {
    display: flex;
    align-items: flex-start; /* Align items to the top */
}

</style>
